CREATE TABLE partners (id SERIAL NOT NULL, firmname VARCHAR(128) NOT NULL, address VARCHAR(128) NOT NULL, contact_number VARCHAR(20) NOT NULL, PRIMARY KEY(id));
CREATE TABLE partners_user (partners_id INT NOT NULL, user_id INT NOT NULL, PRIMARY KEY(partners_id, user_id));
CREATE INDEX IDX_B3E4CF7ABDE7F1C6 ON partners_user (partners_id);
CREATE INDEX IDX_B3E4CF7AA76ED395 ON partners_user (user_id);
CREATE TABLE affiliates (id SERIAL NOT NULL, manager_id INT DEFAULT NULL, address VARCHAR(128) NOT NULL, contact_number VARCHAR(20) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_108C6A8F783E3463 ON affiliates (manager_id);
CREATE UNIQUE INDEX UNIQ_ADDRESS ON affiliates (address);
CREATE TABLE "user" (id SERIAL NOT NULL, email VARCHAR(64) NOT NULL, roles JSON NOT NULL, password VARCHAR(255) NOT NULL, phone VARCHAR(20) DEFAULT NULL, username VARCHAR(64) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_IDENTIFIER_EMAIL ON "user" (email);
CREATE TABLE assortiment (id SERIAL NOT NULL, product_id INT NOT NULL, affiliate_id INT DEFAULT NULL, quantity INT DEFAULT 0 NOT NULL, price DOUBLE PRECISION DEFAULT '0' NOT NULL, daily_delivery INT DEFAULT 0 NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_7366C5784584665A ON assortiment (product_id);
CREATE INDEX IDX_7366C5789F12C49A ON assortiment (affiliate_id);
CREATE TABLE deliveries (id SERIAL NOT NULL, supplier_id INT NOT NULL, ingredient_id INT NOT NULL, date DATE NOT NULL, quantity INT DEFAULT 0 NOT NULL, price DOUBLE PRECISION DEFAULT '0' NOT NULL, status VARCHAR(255) NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_6F0785682ADD6D8C ON deliveries (supplier_id);
CREATE INDEX IDX_6F078568933FE08C ON deliveries (ingredient_id);
CREATE TABLE ingredients (id SERIAL NOT NULL, quantity INT NOT NULL, name VARCHAR(128) NOT NULL, PRIMARY KEY(id));
CREATE TABLE orders (id SERIAL NOT NULL, reciever_partner_id INT NOT NULL, product_id INT NOT NULL, price DOUBLE PRECISION DEFAULT '0' NOT NULL, quantity INT DEFAULT 0 NOT NULL, status VARCHAR(255) NOT NULL, date DATE NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_E52FFDEE32E0841B ON orders (reciever_partner_id);
CREATE INDEX IDX_E52FFDEE4584665A ON orders (product_id);
CREATE TABLE production_plan (id SERIAL NOT NULL, product_id INT NOT NULL, date DATE NOT NULL, quantity INT DEFAULT 0 NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_64A10694584665A ON production_plan (product_id);
CREATE TABLE products (id SERIAL NOT NULL, production_cost DOUBLE PRECISION DEFAULT '0' NOT NULL, name VARCHAR(128) NOT NULL, quantity_storaged INT DEFAULT 0 NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_NAME ON products (name);
CREATE TABLE products_movement (id SERIAL NOT NULL, affiliate_id INT NOT NULL, product_id INT NOT NULL, realised_price DOUBLE PRECISION DEFAULT '0' NOT NULL, realised_count INT DEFAULT 0 NOT NULL, recieved_cost DOUBLE PRECISION DEFAULT '0' NOT NULL, recieved_count INT DEFAULT 0 NOT NULL, date DATE NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_E1DC85449F12C49A ON products_movement (affiliate_id);
CREATE INDEX IDX_E1DC85444584665A ON products_movement (product_id);
CREATE TABLE products_recipies (id SERIAL NOT NULL, product_id_id INT NOT NULL, ingredient_id_id INT NOT NULL, quantity INT DEFAULT 0 NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_A025BDEADE18E50B ON products_recipies (product_id_id);
CREATE INDEX IDX_A025BDEA6676F996 ON products_recipies (ingredient_id_id);
CREATE TABLE suppliers (id SERIAL NOT NULL, firmname VARCHAR(128) NOT NULL, address VARCHAR(128) NOT NULL, contact_number VARCHAR(20) NOT NULL, PRIMARY KEY(id));
CREATE TABLE suppliers_user (suppliers_id INT NOT NULL, user_id INT NOT NULL, PRIMARY KEY(suppliers_id, user_id));
CREATE INDEX IDX_79C36135355AF43 ON suppliers_user (suppliers_id);
CREATE INDEX IDX_79C36135A76ED395 ON suppliers_user (user_id);
CREATE TABLE director_affiliate_finance_view (affiliate_id INT NOT NULL, affiliate_address VARCHAR(255) NOT NULL, contact_number VARCHAR(20) NOT NULL, manager_id INT DEFAULT NULL, manager_name VARCHAR(255) DEFAULT NULL, manager_phone VARCHAR(20) DEFAULT NULL, day DATE NOT NULL, revenue DOUBLE PRECISION NOT NULL, cost DOUBLE PRECISION NOT NULL, net_revenue DOUBLE PRECISION NOT NULL, PRIMARY KEY(affiliate_id));
CREATE TABLE director_orders_view (order_id INT NOT NULL, partner_firmname VARCHAR(128) NOT NULL, product VARCHAR(128) NOT NULL, price DOUBLE PRECISION NOT NULL, quantity INT NOT NULL, status VARCHAR(32) NOT NULL, date DATE NOT NULL, PRIMARY KEY(order_id));
CREATE TABLE director_production_report_summary_view (id INT NOT NULL, product_name VARCHAR(128) NOT NULL, sells_revenue DOUBLE PRECISION NOT NULL, orders_revenue DOUBLE PRECISION NOT NULL, production_cost DOUBLE PRECISION NOT NULL, producted_count INT NOT NULL, sold_count INT NOT NULL, ordered_count INT NOT NULL, realisation_index DOUBLE PRECISION NOT NULL, order_index DOUBLE PRECISION NOT NULL, net_revenue DOUBLE PRECISION NOT NULL, PRIMARY KEY(id));
CREATE TABLE director_production_report_view (id INT NOT NULL, product_name VARCHAR(128) NOT NULL, date DATE DEFAULT NULL, sells_revenue DOUBLE PRECISION NOT NULL, orders_revenue DOUBLE PRECISION NOT NULL, production_cost DOUBLE PRECISION NOT NULL, producted_count INT NOT NULL, sold_count INT NOT NULL, ordered_count INT NOT NULL, realisation_index DOUBLE PRECISION NOT NULL, order_index DOUBLE PRECISION NOT NULL, net_revenue DOUBLE PRECISION NOT NULL, PRIMARY KEY(id));
CREATE TABLE director_production_view (product_id INT NOT NULL, product_name VARCHAR(128) NOT NULL, production_cost DOUBLE PRECISION NOT NULL, PRIMARY KEY(product_id));
CREATE TABLE user_products_view (product VARCHAR(128) NOT NULL, price DOUBLE PRECISION NOT NULL, quantity INT NOT NULL, PRIMARY KEY(product));
ALTER TABLE partners_user ADD CONSTRAINT FK_B3E4CF7ABDE7F1C6 FOREIGN KEY (partners_id) REFERENCES partners (id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE partners_user ADD CONSTRAINT FK_B3E4CF7AA76ED395 FOREIGN KEY (user_id) REFERENCES "user" (id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE affiliates ADD CONSTRAINT FK_108C6A8F783E3463 FOREIGN KEY (manager_id) REFERENCES "user" (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE assortiment ADD CONSTRAINT FK_7366C5784584665A FOREIGN KEY (product_id) REFERENCES products (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE assortiment ADD CONSTRAINT FK_7366C5789F12C49A FOREIGN KEY (affiliate_id) REFERENCES affiliates (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE deliveries ADD CONSTRAINT FK_6F0785682ADD6D8C FOREIGN KEY (supplier_id) REFERENCES suppliers (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE deliveries ADD CONSTRAINT FK_6F078568933FE08C FOREIGN KEY (ingredient_id) REFERENCES ingredients (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE orders ADD CONSTRAINT FK_E52FFDEE32E0841B FOREIGN KEY (reciever_partner_id) REFERENCES partners (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE orders ADD CONSTRAINT FK_E52FFDEE4584665A FOREIGN KEY (product_id) REFERENCES products (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE production_plan ADD CONSTRAINT FK_64A10694584665A FOREIGN KEY (product_id) REFERENCES products (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE products_movement ADD CONSTRAINT FK_E1DC85449F12C49A FOREIGN KEY (affiliate_id) REFERENCES affiliates (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE products_movement ADD CONSTRAINT FK_E1DC85444584665A FOREIGN KEY (product_id) REFERENCES products (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE products_recipies ADD CONSTRAINT FK_A025BDEADE18E50B FOREIGN KEY (product_id_id) REFERENCES products (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE products_recipies ADD CONSTRAINT FK_A025BDEA6676F996 FOREIGN KEY (ingredient_id_id) REFERENCES ingredients (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE suppliers_user ADD CONSTRAINT FK_79C36135355AF43 FOREIGN KEY (suppliers_id) REFERENCES suppliers (id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE suppliers_user ADD CONSTRAINT FK_79C36135A76ED395 FOREIGN KEY (user_id) REFERENCES "user" (id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
